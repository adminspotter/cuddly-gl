#!/usr/bin/env perl

use strict;
use warnings;

use Test::More 'tests' => 6;

use X11::GUITest qw(:ALL :CONST);

my $screenshot_count = 0;

sub take_screenshot
{
    system("xwd -name ui-test -out uitest${screenshot_count}.xwd");
    ++$screenshot_count;
}

{
    my $test = 'run program';

    StartApp('./uitest');
    my ($uitest) = WaitWindowViewable('ui-test');
    ok($uitest, "$test: found window");


    my $status = ClickWindow($uitest, 60, 185, M_BTN1);
    ok($status, "$test: clicked button 1");

    $status = ClickWindow($uitest, 521, 36, M_BTN1);
    ok($status, "$test: reoriented row-column 1");

    my ($x, $y, $width, $height, $borderWidth) = GetWindowPos($uitest);
    $status = MoveMouseAbs($x + $borderWidth + 1, $y + $borderWidth + 1);
    ok($status, "$test: moved mouse to upper left");

    $status = SendKeys('{ESC}');
    ok($status, "$test: escape key sent");

    $status = WaitWindowClose($uitest);
    ok($status, "$test: window is gone");
}
